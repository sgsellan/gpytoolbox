
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../reach_for_the_arcs/">
      
      
        <link rel="next" href="../read_dmat/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>reach_for_the_spheres - Gpytoolbox</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-YDMBBH2H8E"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-YDMBBH2H8E",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-YDMBBH2H8E",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.gpytoolbox.reach_for_the_spheres.ReachForTheSpheresState" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Gpytoolbox" class="md-header__button md-logo" aria-label="Gpytoolbox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gpytoolbox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              reach_for_the_spheres
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/sgsellan/gpytoolbox" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sgsellan/gpytoolbox
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Gpytoolbox" class="md-nav__button md-logo" aria-label="Gpytoolbox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Gpytoolbox
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sgsellan/gpytoolbox" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sgsellan/gpytoolbox
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../adjacency_matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    adjacency_matrix
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../angle_defect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    angle_defect
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../angle_defect_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    angle_defect_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../apply_colormap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    apply_colormap
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../approximate_hausdorff_distance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    approximate_hausdorff_distance
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../array_correspondence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    array_correspondence
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../bad_quad_mesh_from_quadtree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bad_quad_mesh_from_quadtree
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../barycenters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    barycenters
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../barycentric_coordinates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    barycentric_coordinates
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../biharmonic_energy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    biharmonic_energy
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../biharmonic_energy_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    biharmonic_energy_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../boundary_edges/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    boundary_edges
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../boundary_faces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    boundary_faces
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../boundary_loops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    boundary_loops
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../boundary_vertices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    boundary_vertices
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../catmull_rom_spline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    catmull_rom_spline
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../colormap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    colormap
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../compactly_supported_normal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    compactly_supported_normal
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../compactly_supported_normal_kernel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    compactly_supported_normal_kernel
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cone
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../connected_components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    connected_components
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cotangent_laplacian/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cotangent_laplacian
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cotangent_laplacian_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cotangent_laplacian_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cotangent_weights/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cotangent_weights
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cotangent_weights_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cotangent_weights_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cut_edges/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cut_edges
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cylinder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cylinder
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_d0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_d0
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_d1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_d1
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h0
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h0_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h0_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h0inv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h0inv
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h0inv_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h0inv_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h1
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h1_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h1_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h1inv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h1inv
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h1inv_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h1inv_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h2
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h2_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h2_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h2inv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h2inv
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec_h2inv_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dec_h2inv_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../decimate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    decimate
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../doublearea/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    doublearea
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../doublearea_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    doublearea_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../edge_edge_distance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    edge_edge_distance
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../edge_indices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    edge_indices
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../edges/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    edges
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    faces
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fast_winding_number/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fast_winding_number
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fd_grad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fd_grad
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fd_interpolate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fd_interpolate
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fd_partial_derivative/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fd_partial_derivative
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fixed_dof_solve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fixed_dof_solve
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gaussian_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gaussian_process
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../grad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    grad
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../grad_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    grad_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../grid_laplacian_eigenfunctions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    grid_laplacian_eigenfunctions
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../grid_neighbors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    grid_neighbors
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../halfedge_edge_map/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    halfedge_edge_map
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../halfedge_lengths/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    halfedge_lengths
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../halfedge_lengths_squared/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    halfedge_lengths_squared
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../halfedges/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    halfedges
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../halffaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    halffaces
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../icosphere/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    icosphere
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../in_element_aabb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    in_element_aabb
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../in_quadtree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    in_quadtree
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../initialize_aabbtree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    initialize_aabbtree
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../initialize_quadtree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    initialize_quadtree
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear_blend_skinning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linear_blend_skinning
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear_elasticity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linear_elasticity
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear_elasticity_stiffness/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linear_elasticity_stiffness
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../marching_cubes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    marching_cubes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../marching_squares/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    marching_squares
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../massmatrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    massmatrix
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../massmatrix_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    massmatrix_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../matrix_from_function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    matrix_from_function
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../metropolis_hastings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    metropolis_hastings
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../min_l1_with_fixed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    min_l1_with_fixed
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../min_quad_with_fixed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    min_quad_with_fixed
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../minimum_distance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    minimum_distance
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../non_manifold_edges/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    non_manifold_edges
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../normalize_points/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    normalize_points
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../offset_surface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    offset_surface
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../particle_swarm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    particle_swarm
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../per_face_normals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    per_face_normals
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../per_vertex_normals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    per_vertex_normals
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../png2poly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    png2poly
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../point_cloud_to_mesh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    point_cloud_to_mesh
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quadtree_boundary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quadtree_boundary
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quadtree_children/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quadtree_children
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quadtree_gradient/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quadtree_gradient
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quadtree_laplacian/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quadtree_laplacian
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../random_points_on_mesh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    random_points_on_mesh
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ray_box_intersect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ray_box_intersect
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ray_mesh_intersect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ray_mesh_intersect
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ray_polyline_intersect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ray_polyline_intersect
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ray_triangle_intersect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ray_triangle_intersect
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../reach_for_the_arcs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reach_for_the_arcs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    reach_for_the_spheres
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    reach_for_the_spheres
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.gpytoolbox.reach_for_the_spheres.ReachForTheSpheresState" class="md-nav__link">
    <span class="md-ellipsis">
      ReachForTheSpheresState
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.gpytoolbox.reach_for_the_spheres.reach_for_the_spheres" class="md-nav__link">
    <span class="md-ellipsis">
      reach_for_the_spheres
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.gpytoolbox.reach_for_the_spheres.reach_for_the_spheres_iteration" class="md-nav__link">
    <span class="md-ellipsis">
      reach_for_the_spheres_iteration
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../read_dmat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    read_dmat
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../read_mesh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    read_mesh
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../regular_circle_polyline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    regular_circle_polyline
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../regular_cube_mesh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    regular_cube_mesh
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../regular_square_mesh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    regular_square_mesh
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../remesh_botsch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    remesh_botsch
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../remove_duplicate_vertices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    remove_duplicate_vertices
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../remove_unreferenced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    remove_unreferenced
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../rotation_matrix_from_vectors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rotation_matrix_from_vectors
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../signed_distance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    signed_distance
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../signed_distance_polygon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    signed_distance_polygon
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../squared_distance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    squared_distance
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../squared_distance_to_element/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    squared_distance_to_element
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../squared_exponential_kernel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    squared_exponential_kernel
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../stochastic_poisson_surface_reconstruction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stochastic_poisson_surface_reconstruction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../subdivide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    subdivide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../subdivide_quad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    subdivide_quad
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tip_angles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tip_angles
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tip_angles_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tip_angles_intrinsic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../torus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torus
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../traverse_aabbtree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    traverse_aabbtree
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../triangle_triangle_adjacency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    triangle_triangle_adjacency
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../triangle_triangle_distance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    triangle_triangle_distance
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../upper_envelope/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upper_envelope
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../volume/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    volume
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../winding_number/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    winding_number
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../write_mesh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    write_mesh
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_128" >
        
          
          <label class="md-nav__link" for="__nav_128" id="__nav_128_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Copyleft
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_128_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_128">
            <span class="md-nav__icon md-icon"></span>
            Copyleft
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../copyleft/do_meshes_intersect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    copyleft.do_meshes_intersect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../copyleft/lazy_cage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    copyleft.lazy_cage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../copyleft/mesh_boolean/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    copyleft.mesh_boolean
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../copyleft/swept_volume/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    copyleft.swept_volume
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.gpytoolbox.reach_for_the_spheres.ReachForTheSpheresState" class="md-nav__link">
    <span class="md-ellipsis">
      ReachForTheSpheresState
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.gpytoolbox.reach_for_the_spheres.reach_for_the_spheres" class="md-nav__link">
    <span class="md-ellipsis">
      reach_for_the_spheres
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.gpytoolbox.reach_for_the_spheres.reach_for_the_spheres_iteration" class="md-nav__link">
    <span class="md-ellipsis">
      reach_for_the_spheres_iteration
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>reach_for_the_spheres</h1>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.gpytoolbox.reach_for_the_spheres.ReachForTheSpheresState" class="doc doc-heading">
            <code>ReachForTheSpheresState</code>


</h2>


    <div class="doc doc-contents ">


      <p>An object to keep state during the iterations of the Reach for the
Spheres method.
Meant to be used in conjunction with <code>reach_for_the_spheres_iteration</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>V</code></td>
            <td>
                  <code>(n,dim) numpy double array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of mesh vertices of the initial mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>F</code></td>
            <td>
                  <code>(m,dim) numpy int array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of triangle indices into V of the initlal mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>U</code></td>
            <td>
                  <code>(k,dim) numpy double array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of SDF sample positions.
The sdf will be sampled at these points</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>S</code></td>
            <td>
                  <code>(k,dim) nummpy double array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of SDF samples at the sample positions in U.
If this is not provided, it will be computed using sdf.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sdf</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The signed distance function to be reconstructed.
This function must take in a (ks,dim) matrix of sample points and
return a (ks,) array of SDF values at these points.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>V_active</code></td>
            <td>
                  <code>(na,dim) numpy double array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of mesh vertices active during iteration</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>F_active</code></td>
            <td>
                  <code>(ma,dim) numpy int array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of triangle indices into V_active of the mesh active during iteration</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>V_inactive</code></td>
            <td>
                  <code>(na,dim) numpy double array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of mesh vertices inactive during iteration</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>F_inactive</code></td>
            <td>
                  <code>(ma,dim) numpy int array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of triangle indices into V_inactive of the mesh inactive during iteration</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rng</code></td>
            <td>
                  <code>numpy random generator, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>numpy rng object used to create randomness during iterations</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>h</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's initial target mesh length for the reconstructed mesh.
This will change during iteration, set min_h if you want to control the
minimum edge length overall.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>min_h</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's minimal target edge length for the reconstructed mesh.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>best_performance</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Remembers the method's best performance</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>convergence_counter</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's convergence counter, used to track for how long progress
has not been made.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>best_avg_error</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Remembers the method's average error.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>resample_counter</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tracks how often the SDF has been resampled.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>V_last_converged</code></td>
            <td>
                  <code>(nl,dim) numpy double array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of mesh vertices for the last known converged mesh.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>F_last_converged</code></td>
            <td>
                  <code>(ml,dim) numpy int array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of triangle indices into V_last_converged for the last known
converged mesh.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>U_batch</code></td>
            <td>
                  <code>(kb,dim) numpy double array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of SDF sample positions as used during the last batching
operation.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>S_batch</code></td>
            <td>
                  <code>(kb,dim) nummpy double array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of SDF samples at the sample positions in U as used during the
last batching operation.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>If you create this object yourself, you should supply V, F, U, S, sdf.
Supply all other parameters only as explicitly needed.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <pre><code class="language-python">import gpytoolbox as gpy
import numpy as npy

# Get a signed distance function
V,F = gpy.read_mesh(&quot;my_mesh.obj&quot;)

# Create an SDF for the mesh
j = 20
sdf = lambda x: gpy.signed_distance(x, V, F)[0]
gx, gy, gz = np.meshgrid(np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1))
U = np.vstack((gx.flatten(), gy.flatten(), gz.flatten())).T

# Create ReachForTheSpheresState to use in iterative method later
V0, F0 = gpy.icosphere(2)
state = ReachForTheSpheresState(V=V0, F=F0, sdf=sdf, U=U)

# Run one iteration of Reach for the Spheres
converged = gpy.reach_for_the_spheres_iteration(state)

# Reconstruct triangle mesh
Vr,Fr = state.V,state.F

#The reconstructed mesh after one iteration is now Vr,Fr
</code></pre>

              <details class="quote">
                <summary>Source code in <code>src/gpytoolbox/reach_for_the_spheres.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ReachForTheSpheresState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An object to keep state during the iterations of the Reach for the</span>
<span class="sd">    Spheres method.</span>
<span class="sd">    Meant to be used in conjunction with `reach_for_the_spheres_iteration`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    V : (n,dim) numpy double array</span>
<span class="sd">        Matrix of mesh vertices of the initial mesh</span>
<span class="sd">    F : (m,dim) numpy int array</span>
<span class="sd">        Matrix of triangle indices into V of the initlal mesh</span>
<span class="sd">    U : (k,dim) numpy double array, optional (default: None)</span>
<span class="sd">        Matrix of SDF sample positions.</span>
<span class="sd">        The sdf will be sampled at these points</span>
<span class="sd">    S : (k,dim) nummpy double array, optional (default: None)</span>
<span class="sd">        Matrix of SDF samples at the sample positions in U.</span>
<span class="sd">        If this is not provided, it will be computed using sdf.</span>
<span class="sd">    sdf: lambda function that takes in a (ks,dim) numpy double array, optional (default: None)</span>
<span class="sd">        The signed distance function to be reconstructed.</span>
<span class="sd">        This function must take in a (ks,dim) matrix of sample points and</span>
<span class="sd">        return a (ks,) array of SDF values at these points.</span>
<span class="sd">    V_active : (na,dim) numpy double array, optional (default: None)</span>
<span class="sd">        Matrix of mesh vertices active during iteration</span>
<span class="sd">    F_active : (ma,dim) numpy int array, optional (default: None)</span>
<span class="sd">        Matrix of triangle indices into V_active of the mesh active during iteration</span>
<span class="sd">    V_inactive : (na,dim) numpy double array, optional (default: None)</span>
<span class="sd">        Matrix of mesh vertices inactive during iteration</span>
<span class="sd">    F_inactive : (ma,dim) numpy int array, optional (default: None)</span>
<span class="sd">        Matrix of triangle indices into V_inactive of the mesh inactive during iteration</span>
<span class="sd">    rng : numpy random generator, optional (default: None)</span>
<span class="sd">        numpy rng object used to create randomness during iterations</span>
<span class="sd">    h : float (default None)</span>
<span class="sd">        The method&#39;s initial target mesh length for the reconstructed mesh.</span>
<span class="sd">        This will change during iteration, set min_h if you want to control the</span>
<span class="sd">        minimum edge length overall.</span>
<span class="sd">    min_h : float (default None)</span>
<span class="sd">        The method&#39;s minimal target edge length for the reconstructed mesh.</span>
<span class="sd">    best_performance : float (default None)</span>
<span class="sd">        Remembers the method&#39;s best performance</span>
<span class="sd">    convergence_counter : int (default None)</span>
<span class="sd">        The method&#39;s convergence counter, used to track for how long progress</span>
<span class="sd">        has not been made.</span>
<span class="sd">    best_avg_error : float (default None)</span>
<span class="sd">        Remembers the method&#39;s average error.</span>
<span class="sd">    resample_counter : int (default None)</span>
<span class="sd">        Tracks how often the SDF has been resampled.</span>
<span class="sd">    V_last_converged : (nl,dim) numpy double array, optional (default: None)</span>
<span class="sd">        Matrix of mesh vertices for the last known converged mesh.</span>
<span class="sd">    F_last_converged : (ml,dim) numpy int array, optional (default: None)</span>
<span class="sd">        Matrix of triangle indices into V_last_converged for the last known</span>
<span class="sd">        converged mesh.</span>
<span class="sd">    U_batch : (kb,dim) numpy double array, optional (default: None)</span>
<span class="sd">        Matrix of SDF sample positions as used during the last batching</span>
<span class="sd">        operation.</span>
<span class="sd">    S_batch : (kb,dim) nummpy double array, optional (default: None)</span>
<span class="sd">        Matrix of SDF samples at the sample positions in U as used during the</span>
<span class="sd">        last batching operation.</span>

<span class="sd">    Notes</span>
<span class="sd">    --------</span>
<span class="sd">    If you create this object yourself, you should supply V, F, U, S, sdf.</span>
<span class="sd">    Supply all other parameters only as explicitly needed.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    import gpytoolbox as gpy</span>
<span class="sd">    import numpy as npy</span>

<span class="sd">    # Get a signed distance function</span>
<span class="sd">    V,F = gpy.read_mesh(&quot;my_mesh.obj&quot;)</span>

<span class="sd">    # Create an SDF for the mesh</span>
<span class="sd">    j = 20</span>
<span class="sd">    sdf = lambda x: gpy.signed_distance(x, V, F)[0]</span>
<span class="sd">    gx, gy, gz = np.meshgrid(np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1))</span>
<span class="sd">    U = np.vstack((gx.flatten(), gy.flatten(), gz.flatten())).T</span>

<span class="sd">    # Create ReachForTheSpheresState to use in iterative method later</span>
<span class="sd">    V0, F0 = gpy.icosphere(2)</span>
<span class="sd">    state = ReachForTheSpheresState(V=V0, F=F0, sdf=sdf, U=U)</span>

<span class="sd">    # Run one iteration of Reach for the Spheres</span>
<span class="sd">    converged = gpy.reach_for_the_spheres_iteration(state)</span>

<span class="sd">    # Reconstruct triangle mesh</span>
<span class="sd">    Vr,Fr = state.V,state.F</span>

<span class="sd">    #The reconstructed mesh after one iteration is now Vr,Fr</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">V</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span>
        <span class="n">U</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">S</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sdf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">V_active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">F_active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">V_inactive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">F_inactive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">its</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">best_performance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">convergence_counter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">best_avg_error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">resample_counter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">V_last_converged</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">F_last_converged</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">U_batch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">S_batch</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">=</span><span class="n">V</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">=</span><span class="n">F</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="o">=</span><span class="n">U</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">=</span><span class="n">S</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sdf</span><span class="o">=</span><span class="n">sdf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_active</span> <span class="o">=</span> <span class="n">V_active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F_active</span> <span class="o">=</span> <span class="n">F_active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_inactive</span> <span class="o">=</span> <span class="n">V_inactive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F_inactive</span> <span class="o">=</span> <span class="n">F_inactive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">rng</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_h</span> <span class="o">=</span> <span class="n">min_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">its</span> <span class="o">=</span> <span class="n">its</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_performance</span> <span class="o">=</span> <span class="n">best_performance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convergence_counter</span> <span class="o">=</span> <span class="n">convergence_counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_avg_error</span> <span class="o">=</span> <span class="n">best_avg_error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resample_counter</span> <span class="o">=</span> <span class="n">resample_counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_last_converged</span> <span class="o">=</span> <span class="n">V_last_converged</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F_last_converged</span> <span class="o">=</span> <span class="n">F_last_converged</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U_batch</span> <span class="o">=</span> <span class="n">U_batch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S_batch</span> <span class="o">=</span> <span class="n">S_batch</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="src.gpytoolbox.reach_for_the_spheres.reach_for_the_spheres" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reach_for_the_spheres</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">sdf</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_U</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linesearch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inside_outside_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resample_samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_detection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_sensitive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remesh_iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fix_boundary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pseudosdf_interior</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Creates a mesh from a signed distance function (SDF) using the
"Reach for the Spheres" method of S. Sellán,  C. Batty, and O. Stein [2023].</p>
<p>This method takes in an sdf, sample points (do not need to be on a grid),
and an initial mesh.
It then flows this initial mesh into a reconstructed mesh that fulfills
the signed distance function.</p>
<p>This method works in dimension 2 (dim==2), where it reconstructs a polyline,
and in dimension 3 (dim==3), where it reconstructs a triangle mesh.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>U</code></td>
            <td>
                  <code>(k,dim) numpy double array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of SDF sample positions.
The sdf will be sampled at these points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sdf</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The signed distance function to be reconstructed.
This function must take in a (ks,dim) matrix of sample points and
return a (ks,) array of SDF values at these points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>V</code></td>
            <td>
                  <code>(n,dim) numpy double array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of mesh vertices of the initial mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>F</code></td>
            <td>
                  <code>(m,dim) numpy int array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of triangle indices into V of the initlal mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>S</code></td>
            <td>
                  <code>(k,dim) nummpy double array, optional (default: None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of SDF samples at the sample positions in U.
If this is not provided, it will be computed using sdf.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>return_U</code></td>
            <td>
                  <code>bool, optional (default: False)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return the matrix of SDF sample positions along with the
reconstructed mesh.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>verbose</code></td>
            <td>
                  <code>bool (default false)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print method statistics during operation.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_iter</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of iterations to perform for the method.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tol</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's tolerance for the sphere tangency test.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>h</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's initial target mesh length for the reconstructed mesh.
This will change during iteration, set min_h if you want to control the
minimum edge length overall.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>min_h</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's minimal target edge length for the reconstructed mesh.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>linesearch</code></td>
            <td>
                  <code>bool (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use a linesearch-like heuristic for the method's timestep.
If not supplied, linesearch is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>min_t</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's minimum timestep.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_t</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's minimum timestep.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dt</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's default timestep.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>inside_outside_test</code></td>
            <td>
                  <code>bool (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use inside-outside testing when projecting points to be
tangent to the sphere.
Turn this off if your distance function is <em>unsigned</em>.
If not supplied, inside-outside test is used</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>resample</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How often to resample the SDF after convergence to extract more
information.
If not supplied, resampling is not performed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>resample_samples</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many samples to use when resampling.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>feature_detection</code></td>
            <td>
                  <code>string (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which feature detection mode to use.
If not supplied, aggressive feature detection is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_sensitive</code></td>
            <td>
                  <code>bool (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use output-sensitive remeshing.
If not supplied, remeshing is output-sensitive.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>remesh_iterations</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many iterations of the remesher to run each step.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>batch_size</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For large amounts of sample points, the method is sped up using sample
point batching.
This parameter specifies how many samples to take for each batch.
Set it to 0 to disable batching.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fix_boundary</code></td>
            <td>
                  <code>bool (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fix the boundary of the mesh during iteration.
If not supplied, the boundary is not fixed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>clamp</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If sdf is a clamped SDF, the clamp value to use.
np.inf for no clamping.
If not supplied, there is no clamping.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pseudosdf_interior</code></td>
            <td>
                  <code>bool (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If enabled, treats every negative SDF value as a bound on the signed
distance, as opposed to an exact signed distance, for use in SDFs
resulting from CSG unions as described by Marschner et al.
"Constructive Solid Geometry on Neural Signed Distance Fields" [2023].
If not supplied, this feature is disabled.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Vr</code></td>            <td>
                  <code>(nr,dim) numpy double array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of mesh vertices of the reconstructed triangle mesh</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>Fr</code></td>            <td>
                  <code>(mr,dim) numpy int array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of triangle indices into Vr of the reconstructed mesh</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>Ur</code></td>            <td>
                  <code>(kr,dim) numpy double array, if requested</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of SDF sample positions.
This can be different from the supplied Ur if the method is set to
resample.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="see-also" open>
  <summary>See Also</summary>
  <p>marching_squares, marching_cubes</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <p>This method has a number of limitations that are described in the paper.
E.g., the method will only work for SDFs that describe surfaces with the
same topology as the initial surface.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <pre><code class="language-python">import gpytoolbox as gpy
import numpy as npy

# Get a signed distance function
V,F = gpy.read_mesh(&quot;my_mesh.obj&quot;)

# Create an SDF for the mesh
j = 20
sdf = lambda x: gpy.signed_distance(x, V, F)[0]
gx, gy, gz = np.meshgrid(np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1))
U = np.vstack((gx.flatten(), gy.flatten(), gz.flatten())).T

# Choose an initial surface for reach_for_the_spheres
V0, F0 = gpy.icosphere(2)

# Reconstruct triangle mesh
Vr,Fr = gpy.reach_for_the_spheres(U, sdf, V0, F0)

#The reconstructed triangle mesh is now Vr,Fr.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/gpytoolbox/reach_for_the_spheres.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reach_for_the_spheres</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">sdf</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">return_U</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">linesearch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">inside_outside_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">resample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">resample_samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_detection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">output_sensitive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">remesh_iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fix_boundary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">clamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pseudosdf_interior</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a mesh from a signed distance function (SDF) using the</span>
<span class="sd">    &quot;Reach for the Spheres&quot; method of S. Sellán,  C. Batty, and O. Stein [2023].</span>

<span class="sd">    This method takes in an sdf, sample points (do not need to be on a grid),</span>
<span class="sd">    and an initial mesh.</span>
<span class="sd">    It then flows this initial mesh into a reconstructed mesh that fulfills</span>
<span class="sd">    the signed distance function.</span>

<span class="sd">    This method works in dimension 2 (dim==2), where it reconstructs a polyline,</span>
<span class="sd">    and in dimension 3 (dim==3), where it reconstructs a triangle mesh.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    U : (k,dim) numpy double array</span>
<span class="sd">        Matrix of SDF sample positions.</span>
<span class="sd">        The sdf will be sampled at these points</span>
<span class="sd">    sdf: lambda function that takes in a (ks,dim) numpy double array</span>
<span class="sd">        The signed distance function to be reconstructed.</span>
<span class="sd">        This function must take in a (ks,dim) matrix of sample points and</span>
<span class="sd">        return a (ks,) array of SDF values at these points.</span>
<span class="sd">    V : (n,dim) numpy double array</span>
<span class="sd">        Matrix of mesh vertices of the initial mesh</span>
<span class="sd">    F : (m,dim) numpy int array</span>
<span class="sd">        Matrix of triangle indices into V of the initlal mesh</span>
<span class="sd">    S : (k,dim) nummpy double array, optional (default: None)</span>
<span class="sd">        Matrix of SDF samples at the sample positions in U.</span>
<span class="sd">        If this is not provided, it will be computed using sdf.</span>
<span class="sd">    return_U : bool, optional (default: False)</span>
<span class="sd">        Whether to return the matrix of SDF sample positions along with the</span>
<span class="sd">        reconstructed mesh.</span>
<span class="sd">    verbose : bool (default false)</span>
<span class="sd">        Whether to print method statistics during operation.</span>
<span class="sd">    max_iter : int (default None)</span>
<span class="sd">        The maximum number of iterations to perform for the method.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    tol : float (default None)</span>
<span class="sd">        The method&#39;s tolerance for the sphere tangency test.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    h : float (default None)</span>
<span class="sd">        The method&#39;s initial target mesh length for the reconstructed mesh.</span>
<span class="sd">        This will change during iteration, set min_h if you want to control the</span>
<span class="sd">        minimum edge length overall.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    min_h : float (default None)</span>
<span class="sd">        The method&#39;s minimal target edge length for the reconstructed mesh.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    linesearch : bool (default None)</span>
<span class="sd">        Whether to use a linesearch-like heuristic for the method&#39;s timestep.</span>
<span class="sd">        If not supplied, linesearch is used.</span>
<span class="sd">    min_t : float (default None)</span>
<span class="sd">        The method&#39;s minimum timestep.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    max_t : float (default None)</span>
<span class="sd">        The method&#39;s minimum timestep.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    dt : float (default None)</span>
<span class="sd">        The method&#39;s default timestep.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    inside_outside_test : bool (default None)</span>
<span class="sd">        Whether to use inside-outside testing when projecting points to be</span>
<span class="sd">        tangent to the sphere.</span>
<span class="sd">        Turn this off if your distance function is *unsigned*.</span>
<span class="sd">        If not supplied, inside-outside test is used</span>
<span class="sd">    resample : int (default None)</span>
<span class="sd">        How often to resample the SDF after convergence to extract more</span>
<span class="sd">        information.</span>
<span class="sd">        If not supplied, resampling is not performed.</span>
<span class="sd">    resample_samples : int (default None)</span>
<span class="sd">        How many samples to use when resampling.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    feature_detection : string (default None)</span>
<span class="sd">        Which feature detection mode to use.</span>
<span class="sd">        If not supplied, aggressive feature detection is used.</span>
<span class="sd">    output_sensitive : bool (default None)</span>
<span class="sd">        Whether to use output-sensitive remeshing.</span>
<span class="sd">        If not supplied, remeshing is output-sensitive.</span>
<span class="sd">    remesh_iterations : int (default None)</span>
<span class="sd">        How many iterations of the remesher to run each step.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    batch_size : int (default None)</span>
<span class="sd">        For large amounts of sample points, the method is sped up using sample</span>
<span class="sd">        point batching.</span>
<span class="sd">        This parameter specifies how many samples to take for each batch.</span>
<span class="sd">        Set it to 0 to disable batching.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    fix_boundary : bool (default None)</span>
<span class="sd">        Whether to fix the boundary of the mesh during iteration.</span>
<span class="sd">        If not supplied, the boundary is not fixed.</span>
<span class="sd">    clamp : float (default None)</span>
<span class="sd">        If sdf is a clamped SDF, the clamp value to use.</span>
<span class="sd">        np.inf for no clamping.</span>
<span class="sd">        If not supplied, there is no clamping.</span>
<span class="sd">    pseudosdf_interior : bool (default None)</span>
<span class="sd">        If enabled, treats every negative SDF value as a bound on the signed</span>
<span class="sd">        distance, as opposed to an exact signed distance, for use in SDFs</span>
<span class="sd">        resulting from CSG unions as described by Marschner et al.</span>
<span class="sd">        &quot;Constructive Solid Geometry on Neural Signed Distance Fields&quot; [2023].</span>
<span class="sd">        If not supplied, this feature is disabled.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Vr : (nr,dim) numpy double array</span>
<span class="sd">        Matrix of mesh vertices of the reconstructed triangle mesh</span>
<span class="sd">    Fr : (mr,dim) numpy int array</span>
<span class="sd">        Matrix of triangle indices into Vr of the reconstructed mesh</span>
<span class="sd">    Ur : (kr,dim) numpy double array, if requested</span>
<span class="sd">        Matrix of SDF sample positions.</span>
<span class="sd">        This can be different from the supplied Ur if the method is set to</span>
<span class="sd">        resample.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    marching_squares, marching_cubes</span>

<span class="sd">    Notes</span>
<span class="sd">    --------</span>
<span class="sd">    This method has a number of limitations that are described in the paper.</span>
<span class="sd">    E.g., the method will only work for SDFs that describe surfaces with the</span>
<span class="sd">    same topology as the initial surface.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    import gpytoolbox as gpy</span>
<span class="sd">    import numpy as npy</span>

<span class="sd">    # Get a signed distance function</span>
<span class="sd">    V,F = gpy.read_mesh(&quot;my_mesh.obj&quot;)</span>

<span class="sd">    # Create an SDF for the mesh</span>
<span class="sd">    j = 20</span>
<span class="sd">    sdf = lambda x: gpy.signed_distance(x, V, F)[0]</span>
<span class="sd">    gx, gy, gz = np.meshgrid(np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1))</span>
<span class="sd">    U = np.vstack((gx.flatten(), gy.flatten(), gz.flatten())).T</span>

<span class="sd">    # Choose an initial surface for reach_for_the_spheres</span>
<span class="sd">    V0, F0 = gpy.icosphere(2)</span>

<span class="sd">    # Reconstruct triangle mesh</span>
<span class="sd">    Vr,Fr = gpy.reach_for_the_spheres(U, sdf, V0, F0)</span>

<span class="sd">    #The reconstructed triangle mesh is now Vr,Fr.</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">state</span> <span class="o">=</span> <span class="n">ReachForTheSpheresState</span><span class="p">(</span><span class="n">V</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="n">F</span><span class="p">,</span> <span class="n">sdf</span><span class="o">=</span><span class="n">sdf</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span>
        <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">min_h</span><span class="o">=</span><span class="n">min_h</span><span class="p">)</span>
    <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">converged</span><span class="p">:</span>
        <span class="n">converged</span> <span class="o">=</span> <span class="n">reach_for_the_spheres_iteration</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>
            <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
            <span class="n">linesearch</span><span class="o">=</span><span class="n">linesearch</span><span class="p">,</span> <span class="n">min_t</span><span class="o">=</span><span class="n">min_t</span><span class="p">,</span> <span class="n">max_t</span><span class="o">=</span><span class="n">max_t</span><span class="p">,</span>
            <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
            <span class="n">inside_outside_test</span><span class="o">=</span><span class="n">inside_outside_test</span><span class="p">,</span>
            <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span>
            <span class="n">resample_samples</span><span class="o">=</span><span class="n">resample_samples</span><span class="p">,</span>
            <span class="n">feature_detection</span><span class="o">=</span><span class="n">feature_detection</span><span class="p">,</span>
            <span class="n">output_sensitive</span><span class="o">=</span><span class="n">output_sensitive</span><span class="p">,</span>
            <span class="n">remesh_iterations</span><span class="o">=</span><span class="n">remesh_iterations</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">fix_boundary</span><span class="o">=</span><span class="n">fix_boundary</span><span class="p">,</span>
            <span class="n">clamp</span><span class="o">=</span><span class="n">clamp</span><span class="p">,</span> <span class="n">pseudosdf_interior</span><span class="o">=</span><span class="n">pseudosdf_interior</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_U</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.gpytoolbox.reach_for_the_spheres.reach_for_the_spheres_iteration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reach_for_the_spheres_iteration</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linesearch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inside_outside_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resample_samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_detection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_sensitive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remesh_iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fix_boundary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pseudosdf_interior</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Performs one iteration of the "Reach for the Spheres" method of
S. Sellán,  C. Batty, and O. Stein [2023].
This method is used to create a mesh from a signed distance function (SDF).</p>
<p>This method takes in the current state of the method in the form of a 
ReachForTheSpheresState object, and stores its results as well as any
temporary information needed in that state object.</p>
<p>This method works in dimension 2 (dim==2), where it reconstructs a polyline,
and in dimension 3 (dim==3), where it reconstructs a triangle mesh.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>state</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stores all needed information about the current state of the method.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_iter</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of iterations to perform for the method.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tol</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's tolerance for the sphere tangency test.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>linesearch</code></td>
            <td>
                  <code>bool (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use a linesearch-like heuristic for the method's timestep.
If not supplied, linesearch is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>min_t</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's minimum timestep.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_t</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's minimum timestep.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dt</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method's default timestep.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>inside_outside_test</code></td>
            <td>
                  <code>bool (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use inside-outside testing when projecting points to be
tangent to the sphere.
Turn this off if your distance function is <em>unsigned</em>.
If not supplied, inside-outside test is used</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>resample</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How often to resample the SDF after convergence to extract more
information.
If not supplied, resampling is not performed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>resample_samples</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many samples to use when resampling.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>feature_detection</code></td>
            <td>
                  <code>string (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which feature detection mode to use.
If not supplied, aggressive feature detection is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_sensitive</code></td>
            <td>
                  <code>bool (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use output-sensitive remeshing.
If not supplied, remeshing is output-sensitive.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>remesh_iterations</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many iterations of the remesher to run each step.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>batch_size</code></td>
            <td>
                  <code>int (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For large amounts of sample points, the method is sped up using sample
point batching.
This parameter specifies how many samples to take for each batch.
Set it to 0 to disable batching.
If not supplied, a sensible default is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fix_boundary</code></td>
            <td>
                  <code>bool (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fix the boundary of the mesh during iteration.
If not supplied, the boundary is not fixed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>clamp</code></td>
            <td>
                  <code>float (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If sdf is a clamped SDF, the clamp value to use.
np.inf for no clamping.
If not supplied, there is no clamping.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pseudosdf_interior</code></td>
            <td>
                  <code>bool (default None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If enabled, treats every negative SDF value as a bound on the signed
distance, as opposed to an exact signed distance, for use in SDFs
resulting from CSG unions as described by Marschner et al.
"Constructive Solid Geometry on Neural Signed Distance Fields" [2023].
If not supplied, this feature is disabled.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>verbose</code></td>
            <td>
                  <code>bool (default false)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print method statistics during operation.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>converged</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the method has converged after this iteration or not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="see-also" open>
  <summary>See Also</summary>
  <p>reach_for_the_spheres, marching_squares, marching_cubes</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <p>This method has a number of limitations that are described in the paper.
E.g., the method will only work for SDFs that describe surfaces with the
same topology as the initial surface.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <pre><code class="language-python">import gpytoolbox as gpy
import numpy as npy

# Get a signed distance function
V,F = gpy.read_mesh(&quot;my_mesh.obj&quot;)

# Create an SDF for the mesh
j = 20
sdf = lambda x: gpy.signed_distance(x, V, F)[0]
gx, gy, gz = np.meshgrid(np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1))
U = np.vstack((gx.flatten(), gy.flatten(), gz.flatten())).T

# Create ReachForTheSpheresState to use in iterative method later
V0, F0 = gpy.icosphere(2)
state = ReachForTheSpheresState(V=V0, F=F0, sdf=sdf, U=U)

# Run one iteration of Reach for the Spheres
converged = gpy.reach_for_the_spheres_iteration(state)

# Reconstruct triangle mesh
Vr,Fr = state.V,state.F

#The reconstructed mesh after one iteration is now Vr,Fr
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/gpytoolbox/reach_for_the_spheres.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reach_for_the_spheres_iteration</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">linesearch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">inside_outside_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">resample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">resample_samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_detection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">output_sensitive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">remesh_iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fix_boundary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">clamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pseudosdf_interior</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs one iteration of the &quot;Reach for the Spheres&quot; method of</span>
<span class="sd">    S. Sellán,  C. Batty, and O. Stein [2023].</span>
<span class="sd">    This method is used to create a mesh from a signed distance function (SDF).</span>

<span class="sd">    This method takes in the current state of the method in the form of a </span>
<span class="sd">    ReachForTheSpheresState object, and stores its results as well as any</span>
<span class="sd">    temporary information needed in that state object.</span>

<span class="sd">    This method works in dimension 2 (dim==2), where it reconstructs a polyline,</span>
<span class="sd">    and in dimension 3 (dim==3), where it reconstructs a triangle mesh.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    state: ReachForTheSpheresState object</span>
<span class="sd">        Stores all needed information about the current state of the method.</span>
<span class="sd">    max_iter : int (default None)</span>
<span class="sd">        The maximum number of iterations to perform for the method.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    tol : float (default None)</span>
<span class="sd">        The method&#39;s tolerance for the sphere tangency test.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    linesearch : bool (default None)</span>
<span class="sd">        Whether to use a linesearch-like heuristic for the method&#39;s timestep.</span>
<span class="sd">        If not supplied, linesearch is used.</span>
<span class="sd">    min_t : float (default None)</span>
<span class="sd">        The method&#39;s minimum timestep.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    max_t : float (default None)</span>
<span class="sd">        The method&#39;s minimum timestep.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    dt : float (default None)</span>
<span class="sd">        The method&#39;s default timestep.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    inside_outside_test : bool (default None)</span>
<span class="sd">        Whether to use inside-outside testing when projecting points to be</span>
<span class="sd">        tangent to the sphere.</span>
<span class="sd">        Turn this off if your distance function is *unsigned*.</span>
<span class="sd">        If not supplied, inside-outside test is used</span>
<span class="sd">    resample : int (default None)</span>
<span class="sd">        How often to resample the SDF after convergence to extract more</span>
<span class="sd">        information.</span>
<span class="sd">        If not supplied, resampling is not performed.</span>
<span class="sd">    resample_samples : int (default None)</span>
<span class="sd">        How many samples to use when resampling.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    feature_detection : string (default None)</span>
<span class="sd">        Which feature detection mode to use.</span>
<span class="sd">        If not supplied, aggressive feature detection is used.</span>
<span class="sd">    output_sensitive : bool (default None)</span>
<span class="sd">        Whether to use output-sensitive remeshing.</span>
<span class="sd">        If not supplied, remeshing is output-sensitive.</span>
<span class="sd">    remesh_iterations : int (default None)</span>
<span class="sd">        How many iterations of the remesher to run each step.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    batch_size : int (default None)</span>
<span class="sd">        For large amounts of sample points, the method is sped up using sample</span>
<span class="sd">        point batching.</span>
<span class="sd">        This parameter specifies how many samples to take for each batch.</span>
<span class="sd">        Set it to 0 to disable batching.</span>
<span class="sd">        If not supplied, a sensible default is used.</span>
<span class="sd">    fix_boundary : bool (default None)</span>
<span class="sd">        Whether to fix the boundary of the mesh during iteration.</span>
<span class="sd">        If not supplied, the boundary is not fixed.</span>
<span class="sd">    clamp : float (default None)</span>
<span class="sd">        If sdf is a clamped SDF, the clamp value to use.</span>
<span class="sd">        np.inf for no clamping.</span>
<span class="sd">        If not supplied, there is no clamping.</span>
<span class="sd">    pseudosdf_interior : bool (default None)</span>
<span class="sd">        If enabled, treats every negative SDF value as a bound on the signed</span>
<span class="sd">        distance, as opposed to an exact signed distance, for use in SDFs</span>
<span class="sd">        resulting from CSG unions as described by Marschner et al.</span>
<span class="sd">        &quot;Constructive Solid Geometry on Neural Signed Distance Fields&quot; [2023].</span>
<span class="sd">        If not supplied, this feature is disabled.</span>
<span class="sd">    verbose : bool (default false)</span>
<span class="sd">        Whether to print method statistics during operation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    converged : bool</span>
<span class="sd">        Whether the method has converged after this iteration or not.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    reach_for_the_spheres, marching_squares, marching_cubes</span>

<span class="sd">    Notes</span>
<span class="sd">    --------</span>
<span class="sd">    This method has a number of limitations that are described in the paper.</span>
<span class="sd">    E.g., the method will only work for SDFs that describe surfaces with the</span>
<span class="sd">    same topology as the initial surface.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    import gpytoolbox as gpy</span>
<span class="sd">    import numpy as npy</span>

<span class="sd">    # Get a signed distance function</span>
<span class="sd">    V,F = gpy.read_mesh(&quot;my_mesh.obj&quot;)</span>

<span class="sd">    # Create an SDF for the mesh</span>
<span class="sd">    j = 20</span>
<span class="sd">    sdf = lambda x: gpy.signed_distance(x, V, F)[0]</span>
<span class="sd">    gx, gy, gz = np.meshgrid(np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1), np.linspace(-1.0, 1.0, j+1))</span>
<span class="sd">    U = np.vstack((gx.flatten(), gy.flatten(), gz.flatten())).T</span>

<span class="sd">    # Create ReachForTheSpheresState to use in iterative method later</span>
<span class="sd">    V0, F0 = gpy.icosphere(2)</span>
<span class="sd">    state = ReachForTheSpheresState(V=V0, F=F0, sdf=sdf, U=U)</span>

<span class="sd">    # Run one iteration of Reach for the Spheres</span>
<span class="sd">    converged = gpy.reach_for_the_spheres_iteration(state)</span>

<span class="sd">    # Reconstruct triangle mesh</span>
<span class="sd">    Vr,Fr = state.V,state.F</span>

<span class="sd">    #The reconstructed mesh after one iteration is now Vr,Fr</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">ReachForTheSpheresState</span><span class="p">),</span> <span class="s2">&quot;State must be a ReachForTheSpheresState&quot;</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">dim</span><span class="o">==</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">dim</span><span class="o">==</span><span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#Set default parameters.</span>
    <span class="c1">#Assign different 2D and 3D default parameters</span>
    <span class="n">default_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">#For each dimension</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;max_iter&#39;</span><span class="p">:</span><span class="mi">10000</span><span class="p">,</span> <span class="s1">&#39;tol&#39;</span><span class="p">:</span><span class="mf">5e-3</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="s1">&#39;linesearch&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;min_t&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;max_t&#39;</span><span class="p">:</span><span class="mf">50.</span><span class="p">,</span>
        <span class="s1">&#39;dt&#39;</span><span class="p">:</span><span class="mf">10.</span><span class="p">,</span>
        <span class="s1">&#39;inside_outside_test&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;resample&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;resample_samples&#39;</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
        <span class="s1">&#39;return_U&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;feature_detection&#39;</span><span class="p">:</span><span class="s1">&#39;aggressive&#39;</span><span class="p">,</span> <span class="s1">&#39;output_sensitive&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;remesh_iterations&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;batch_size&#39;</span><span class="p">:</span><span class="mi">20000</span><span class="p">,</span>
        <span class="s1">&#39;fix_boundary&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;clamp&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="s1">&#39;pseudosdf_interior&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
        <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;max_iter&#39;</span><span class="p">:</span><span class="mi">20000</span><span class="p">,</span> <span class="s1">&#39;tol&#39;</span><span class="p">:</span><span class="mf">1e-2</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="s1">&#39;linesearch&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;min_t&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;max_t&#39;</span><span class="p">:</span><span class="mf">50.</span><span class="p">,</span>
        <span class="s1">&#39;dt&#39;</span><span class="p">:</span><span class="mf">10.</span><span class="p">,</span>
        <span class="s1">&#39;inside_outside_test&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;resample&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;resample_samples&#39;</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
        <span class="s1">&#39;feature_detection&#39;</span><span class="p">:</span><span class="s1">&#39;aggressive&#39;</span><span class="p">,</span> <span class="s1">&#39;output_sensitive&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;remesh_iterations&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;visualize&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;batch_size&#39;</span><span class="p">:</span><span class="mi">20000</span><span class="p">,</span>
        <span class="s1">&#39;fix_boundary&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;clamp&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="s1">&#39;pseudosdf_interior&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">max_iter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;tol&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">linesearch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linesearch</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;linesearch&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">min_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">min_t</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;min_t&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_t</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;max_t&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">inside_outside_test</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inside_outside_test</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;inside_outside_test&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">resample</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resample</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;resample&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">resample_samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resample_samples</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;resample_samples&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">feature_detection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">feature_detection</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;feature_detection&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">output_sensitive</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_sensitive</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;output_sensitive&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">remesh_iterations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">remesh_iterations</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;remesh_iterations&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;batch_size&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">fix_boundary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fix_boundary</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;fix_boundary&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">clamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">clamp</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;clamp&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pseudosdf_interior</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pseudosdf_interior</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;pseudosdf_interior&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="s1">&#39;h&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">state</span><span class="o">.</span><span class="n">sdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;If you do not provide U, you must provide an sdf function to sample.&quot;</span>
        <span class="n">state</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">_sample_sdf</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">sdf</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">S</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">state</span><span class="o">.</span><span class="n">sdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;If you do not provide S, you must provide an sdf function to sample.&quot;</span>
        <span class="n">state</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">sdf</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">min_h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use a kdtree and get the average distance between two samples</span>
        <span class="c1"># import cKDTree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">cKDTree</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="p">)</span>
        <span class="n">dists</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">min_h</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dists</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">state</span><span class="o">.</span><span class="n">min_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">min_h</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="n">nu_0</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nu_max</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">nu_0</span>

    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">68</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">its</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">its</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">best_performance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">best_performance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">convergence_counter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">convergence_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">best_avg_error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">best_avg_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="c1"># if state.use_features is None:</span>
    <span class="c1">#     state.use_features = False</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">V_last_converged</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">V_last_converged</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">F_last_converged</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">F_last_converged</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">resample_counter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">resample_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">U_batch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">U_batch</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">S_batch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">S_batch</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">remeshing</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1">#Do we prematurely abort? Increment iteration.</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">its</span><span class="o">&gt;=</span><span class="n">max_iter</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1">#Algorithm</span>
    <span class="k">if</span> <span class="n">batch_size</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">batch_size</span><span class="o">&lt;</span><span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">inds</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">U_batch</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="p">[</span><span class="n">inds</span><span class="p">,:]</span>
        <span class="n">state</span><span class="o">.</span><span class="n">S_batch</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
        <span class="c1"># include all inside points</span>
        <span class="n">state</span><span class="o">.</span><span class="n">U_batch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">state</span><span class="o">.</span><span class="n">U_batch</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">S</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">,:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">S_batch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">state</span><span class="o">.</span><span class="n">S_batch</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">S</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">d2</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">squared_distance</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">U_batch</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">,</span>
        <span class="n">use_cpp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_aabb</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">S_batch</span><span class="p">)</span><span class="o">-</span><span class="n">d</span>

    <span class="c1">#closest point on edge to u</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">[</span><span class="n">I</span><span class="p">,:],:]</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pemU</span> <span class="o">=</span> <span class="n">pe</span><span class="o">-</span><span class="n">state</span><span class="o">.</span><span class="n">U_batch</span>
    <span class="k">if</span> <span class="n">inside_outside_test</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pemU</span><span class="o">*</span><span class="n">_normals</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">)[</span><span class="n">I</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">hit_sides</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">b</span><span class="o">&lt;</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#too close to vertex</span>
        <span class="n">s</span><span class="p">[</span><span class="n">hit_sides</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">S_batch</span><span class="p">)[</span><span class="n">hit_sides</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">S_batch</span><span class="p">)</span>
    <span class="c1">#closest signed point on sphere to pe</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">U_batch</span><span class="o">+</span><span class="n">pemU</span><span class="o">*</span><span class="p">((</span><span class="n">s</span><span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">S_batch</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">tol</span><span class="p">,</span><span class="n">d</span><span class="p">))[:,</span><span class="kc">None</span><span class="p">])</span>
    <span class="n">valid_U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span>
    <span class="n">invalid_U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">valid_U</span><span class="p">)</span>
    <span class="n">F_invalid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">invalid_U</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">feature_detection</span><span class="o">==</span><span class="s1">&#39;aggressive&#39;</span><span class="p">:</span>
        <span class="n">V_invalid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">[</span><span class="n">F_invalid</span><span class="p">,:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">feature_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">V_invalid</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">F_invalid</span><span class="p">)</span>
        <span class="n">feature_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">[</span><span class="n">F_valid</span><span class="p">,:])</span>

    <span class="c1">#Build matrices</span>
    <span class="n">wu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">U_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">clamped_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">S_batch</span><span class="p">)</span><span class="o">==</span><span class="n">clamp</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">&lt;</span><span class="mf">0.</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">pseudosdf_interior</span><span class="p">:</span>
        <span class="n">clamped_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">state</span><span class="o">.</span><span class="n">S_batch</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">&lt;</span><span class="mf">0.</span><span class="p">))</span>
    <span class="n">wu</span><span class="p">[</span><span class="n">clamped_g</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">(((</span><span class="n">wu</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">U_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span><span class="kc">None</span><span class="p">],</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
            <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">[</span><span class="n">I</span><span class="p">,:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())),</span>
        <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">U_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">wu</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">ps</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">_massmatrix</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">U_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">([</span><span class="n">rho</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1">#Compute timestep t</span>
    <span class="k">if</span> <span class="n">linesearch</span><span class="p">:</span>
        <span class="c1"># Backtracking linesearch</span>
        <span class="c1"># Nocedal &amp; Wright Algorithm 3.1</span>
        <span class="n">n_c</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">n_p</span> <span class="o">=</span> <span class="o">-</span><span class="n">A</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">-</span><span class="n">c</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">A</span><span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">n_p</span><span class="p">)))</span> <span class="o">+</span> <span class="n">n_c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n_p</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> \
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">A</span><span class="o">*</span><span class="n">n_p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">n_p</span><span class="p">)))</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">posinf</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">neginf</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_t</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">min_t</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span>

    <span class="c1">#Minimize</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">M</span> <span class="o">+</span> <span class="n">t</span><span class="o">*</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">A</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">M</span><span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">V</span> <span class="o">+</span> <span class="n">t</span><span class="o">*</span><span class="n">A</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fix_boundary</span><span class="p">:</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="n">boundary_vertices</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">)</span>
        <span class="n">precomp</span> <span class="o">=</span> <span class="n">fixed_dof_solve_precompute</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">bd</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">precomp</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="n">bd</span><span class="p">,:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">spsolve</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

    <span class="c1"># catching flow singularities so we fail gracefully</span>

    <span class="n">there_are_non_manifold_edges</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">dim</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">there_are_non_manifold_edges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_manifold_edges</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span>
    <span class="k">elif</span> <span class="n">dim</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">he_nm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># print(he)</span>
        <span class="n">he_u_nm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">he_nm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># print(he)</span>
        <span class="n">ne_nm</span> <span class="o">=</span> <span class="n">he_u_nm</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">he_u_nm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">there_are_non_manifold_edges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ne_nm</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">)))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">doublearea</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">there_are_non_manifold_edges</span> <span class="p">:</span> 

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;we found a flow singularity. Returning the last converged solution.&quot;</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">V_last_converged</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">state</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">F_last_converged</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1">#Convergence determination</span>
    <span class="n">state</span><span class="o">.</span><span class="n">avg_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iteration:&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">its</span><span class="p">,</span> <span class="s2">&quot;Counter:&quot;</span><span class="p">,</span><span class="n">state</span><span class="o">.</span><span class="n">convergence_counter</span><span class="p">,</span> <span class="s2">&quot;h:&quot;</span><span class="p">,</span><span class="n">state</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="s2">&quot;Average error:&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">avg_error</span><span class="p">,</span> <span class="s2">&quot;Best avg error:&quot;</span><span class="p">,</span><span class="n">state</span><span class="o">.</span><span class="n">best_avg_error</span><span class="p">,</span> <span class="s2">&quot;Max error:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">-</span><span class="n">c</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">avg_error</span><span class="o">+</span><span class="mf">1e-3</span><span class="o">*</span><span class="n">tol</span> <span class="o">&gt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">best_avg_error</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">convergence_counter</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">convergence_counter</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">convergence_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">state</span><span class="o">.</span><span class="n">best_avg_error</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">avg_error</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">convergence_counter</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="c1"># if h==min_h:</span>
        <span class="c1">#     remeshing = False</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">h</span><span class="o">&gt;</span><span class="n">state</span><span class="o">.</span><span class="n">min_h</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">V_last_converged</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">state</span><span class="o">.</span><span class="n">F_last_converged</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">state</span><span class="o">.</span><span class="n">best_avg_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">state</span><span class="o">.</span><span class="n">convergence_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">state</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">state</span><span class="o">.</span><span class="n">min_h</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">convergence_counter</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">or</span> <span class="n">F_invalid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">resample_counter</span><span class="o">&lt;</span><span class="n">resample</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">_sample_sdf</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">sdf</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="p">,</span>
                <span class="n">new_n</span><span class="o">=</span><span class="n">resample_samples</span><span class="p">,</span>
                <span class="n">trial_n</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">50</span><span class="o">*</span><span class="n">resample_samples</span><span class="p">),</span> <span class="n">max_n</span><span class="o">=</span><span class="n">nu_max</span><span class="p">,</span>
                <span class="n">remove_samples</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_these_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nu_0</span><span class="p">),</span>
                <span class="n">rng</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">state</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">sdf</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="p">)</span>
            <span class="n">state</span><span class="o">.</span><span class="n">U_batch</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">state</span><span class="o">.</span><span class="n">S_batch</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">state</span><span class="o">.</span><span class="n">resample_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">state</span><span class="o">.</span><span class="n">best_performance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">state</span><span class="o">.</span><span class="n">convergence_counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">state</span><span class="o">.</span><span class="n">best_avg_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resampled, I now have </span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> sample points.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We have converged.</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="c1">#Remeshing</span>
    <span class="k">if</span> <span class="n">remeshing</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">output_sensitive</span> <span class="ow">and</span> <span class="n">F_invalid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># we find the invalid faces</span>
            <span class="n">F_invalid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">invalid_U</span><span class="p">])</span>
            <span class="c1"># We compute the face adjacency matrix</span>
            <span class="n">TT</span> <span class="o">=</span> <span class="n">_face_adjacency</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">)</span>
            <span class="c1"># We find the set of invalid faces and their neighbors</span>
            <span class="n">F_invalid_neighbors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">TT</span><span class="p">[</span><span class="n">F_invalid</span><span class="p">,:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="c1"># also add the invalid faces</span>
            <span class="c1"># F_invalid_neighbors = np.unique(np.hstack((F_invalid_neighbors,F_invalid)))</span>
            <span class="n">F_invalid_neighbors</span> <span class="o">=</span> <span class="n">_one_ring</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">,</span><span class="n">F_invalid</span><span class="p">)</span>
            <span class="c1"># do another round of one ring</span>
            <span class="n">F_invalid_neighbors</span> <span class="o">=</span> <span class="n">_one_ring</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">,</span><span class="n">F_invalid_neighbors</span><span class="p">)</span>
            <span class="c1"># We find the set of invalid vertices</span>
            <span class="c1"># F_active = F[F_invalid_neighbors,:]</span>
            <span class="n">state</span><span class="o">.</span><span class="n">V_active</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F_active</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">remove_unreferenced</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span>
                <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">[</span><span class="n">F_invalid_neighbors</span><span class="p">,:],</span> <span class="n">return_maps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F_active</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">state</span><span class="o">.</span><span class="n">F_active</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="c1"># set of inactive faces</span>
                <span class="n">state</span><span class="o">.</span><span class="n">F_inactive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">F_invalid_neighbors</span><span class="p">)</span>
                <span class="c1"># set of inactive vertices</span>
                <span class="n">state</span><span class="o">.</span><span class="n">V_inactive</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F_inactive</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">remove_unreferenced</span><span class="p">(</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">F_inactive</span><span class="p">,:],</span><span class="n">return_maps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># Remesh only the active part</span>
                <span class="n">state</span><span class="o">.</span><span class="n">V_active</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F_active</span> <span class="o">=</span> <span class="n">_remesh</span><span class="p">(</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">V_active</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F_active</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">remesh_iterations</span><span class="p">,</span>
                    <span class="n">h</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># We merge the active and inactive parts</span>
                <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">_merge_meshes</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V_active</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F_active</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">V_inactive</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F_inactive</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">_remesh</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">,</span>
                    <span class="n">i</span><span class="o">=</span><span class="n">remesh_iterations</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">_remesh</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">F</span><span class="p">,</span>
                <span class="n">i</span><span class="o">=</span><span class="n">remesh_iterations</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">project</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">feature</span><span class="o">=</span><span class="n">feature_vertices</span><span class="p">)</span>
            <span class="n">state</span><span class="o">.</span><span class="n">V_active</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">state</span><span class="o">.</span><span class="n">F_active</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">state</span><span class="o">.</span><span class="n">V_inactive</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">state</span><span class="o">.</span><span class="n">F_inactive</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">V_active</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">state</span><span class="o">.</span><span class="n">F_active</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">state</span><span class="o">.</span><span class="n">V_inactive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">state</span><span class="o">.</span><span class="n">F_inactive</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">#Have we converged?</span>
    <span class="n">state</span><span class="o">.</span><span class="n">its</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">its</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">its</span><span class="o">&gt;=</span><span class="n">max_iter</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>